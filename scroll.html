<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Card Stack Scroll</title>
    <style>
        /* Scope all styles to #card-stack-scroll */
        #card-stack-scroll {
            background-color: #f3f4f6;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
        }
        #card-stack-scroll .sticky-container {
            position: sticky;
            top: 0;
            height: 100vh;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        #card-stack-scroll .cards-wrapper {
            position: relative;
            width: 90vw;
            height: 75vh;
            max-width: 42rem;
        }
        #card-stack-scroll .card {
            position: absolute;
            inset: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 1rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            padding: 2rem;
            text-align: center;
        }
        #card-stack-scroll .card-1 { background-image: linear-gradient(to bottom, #bbf7d0, #bfdbfe); }
        #card-stack-scroll .card-2 { background-image: linear-gradient(to bottom, #3730a3, #6b21a8); color: white; }
        #card-stack-scroll .card-3 { background-image: linear-gradient(to bottom, #6b21a8, #be185d); color: white; }
        #card-stack-scroll .card-4 { background-image: linear-gradient(to bottom, #bfdbfe, #e0e7ff); color: black; }
        #card-stack-scroll .card-5 { background-image: linear-gradient(to bottom, #fdba74, #f87171); color: white; }
        #card-stack-scroll .card-6 { background-image: linear-gradient(to bottom, #fde047, #86efac); color: #1f2937; }
        #card-stack-scroll .card-7 { background-image: linear-gradient(to bottom, #9ca3af, #64748b); color: white; }
        #card-stack-scroll .card h2 {
            font-size: 2.25rem;
            font-weight: 700;
            margin: 0;
        }
        #card-stack-scroll .card p {
            margin-top: 0.5rem;
        }
    </style>
</head>
<body>

<div id="card-stack-scroll">
  <div id="scroll-container">
    <div class="sticky-container">
      <div class="cards-wrapper">
        <div class="card card-1"><h2>The First slide</h2><p>Scroll Down for next slide</p></div>
        <div class="card card-2"><h2>The Second slide</h2><p>Keep going!</p></div>
        <div class="card card-3"><h2>The Third slide</h2><p>Scroll Down</p></div>
        <div class="card card-4"><h2>The Fourth slide</h2></div>
        <div class="card card-5"><h2>The Fifth slide</h2></div>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const root = document.getElementById('card-stack-scroll');
  const cards = Array.from(root.querySelectorAll('.card'));
  const scrollContainer = root.querySelector('#scroll-container');
  const numCards = cards.length;
  const vh = window.innerHeight;

  // Set height for scrolling. Each card transition takes one viewport height.
  scrollContainer.style.height = `${100 * numCards}vh`;

  // --- Snap Scrolling Logic ---
  let currentCardIndex = 0;
  let isAnimating = false;

  function snapToCard(index) {
    if (isAnimating || index < 0 || index > numCards) return;
    isAnimating = true;
    currentCardIndex = index;
    window.scrollTo({
      top: index * vh,
      behavior: 'smooth'
    });
    setTimeout(() => {
      isAnimating = false;
    }, 900);
  }

  // Only handle scroll/wheel/keyboard if mouse is over the widget
  let isActive = false;
  root.addEventListener('mouseenter', () => { isActive = true; });
  root.addEventListener('mouseleave', () => { isActive = false; });

  window.addEventListener('wheel', (event) => {
    if (!isActive) return;
    event.preventDefault();
    if (isAnimating) return;
    if (event.deltaY > 0) {
      snapToCard(currentCardIndex + 1);
    } else {
      snapToCard(currentCardIndex - 1);
    }
  }, { passive: false });

  window.addEventListener('keydown', (event) => {
    if (!isActive) return;
    if (isAnimating) return;
    if (event.key === 'ArrowDown' || event.key === 'PageDown') {
      event.preventDefault();
      snapToCard(currentCardIndex + 1);
    } else if (event.key === 'ArrowUp' || event.key === 'PageUp') {
      event.preventDefault();
      snapToCard(currentCardIndex - 1);
    }
  });

  window.addEventListener('scroll', () => {
    const scrollY = window.scrollY;
    cards.forEach((card, i) => {
      const sectionStart = i * vh;
      const scrollInSection = scrollY - sectionStart;
      const finalSideOffset = 90;
      const startHorizontalOffset = 90;
      if (scrollInSection >= 0 && scrollInSection < 2 * vh) {
        card.style.zIndex = i;
        if (scrollInSection < vh) {
          const progress = scrollInSection / vh;
          const scale = 0.85 + progress * 0.15;
          const translateY = 100 - (progress * 100);
          const translateX = (i % 2 === 0)
            ? startHorizontalOffset - ((startHorizontalOffset - finalSideOffset) * progress)
            : -startHorizontalOffset + ((startHorizontalOffset - finalSideOffset) * progress);
          card.style.transform = `translateX(${translateX}%) translateY(${translateY}%) scale(${scale})`;
          card.style.opacity = progress;
        } else {
          const progress = (scrollInSection - vh) / vh;
          const opacity = 1 - progress;
          const translateX = (i % 2 === 0) ? finalSideOffset : -finalSideOffset;
          card.style.transform = `translateX(${translateX}%) translateY(0%) scale(1)`;
          card.style.opacity = opacity;
        }
      } else if (scrollInSection < 0) {
        const initialTranslateX = (i % 2 === 0) ? startHorizontalOffset : -startHorizontalOffset;
        card.style.transform = `translateX(${initialTranslateX}%) translateY(100%) scale(0.85)`;
        card.style.opacity = 0;
      } else {
        card.style.opacity = 0;
      }
    });
  });

  window.dispatchEvent(new Event('scroll'));
});
</script>

</body>
</html>